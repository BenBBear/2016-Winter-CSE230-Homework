<h1 id="k-means-clustering">K-Means Clustering</h1>
<div class="hidden">
<pre><span class=hs-linenum> 7: </span><span class='hs-keyword'>{-@</span> <span class='hs-conid'>LIQUID</span> <span class='hs-str'>"--short-names"</span>    <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 8: </span><span class='hs-keyword'>{-@</span> <span class='hs-conid'>LIQUID</span> <span class='hs-str'>"--no-termination"</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 9: </span>
<span class=hs-linenum>10: </span>
<span class=hs-linenum>11: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>PointNE</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Point</span> <span class='hs-keyglyph'>|</span> <span class='hs-num'>0</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>size</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>12: </span>
<span class=hs-linenum>13: </span>
<span class=hs-linenum>14: </span>
<span class=hs-linenum>15: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>clusterDimension</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Cluster</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>16: </span>    <span class='hs-varid'>clusterDimension</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-layout'>,</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>size</span><span class='hs-layout'>(</span><span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<span class=hs-linenum>17: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>18: </span>
<span class=hs-linenum>19: </span>
<span class=hs-linenum>20: </span>
<span class=hs-linenum>21: </span>
<span class=hs-linenum>22: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>KMeans</span> <span class='hs-layout'>(</span><span class='hs-varid'>kmeans</span><span class='hs-layout'>,</span> <span class='hs-varid'>kmeans1</span><span class='hs-layout'>,</span> <span class='hs-varid'>nearest</span><span class='hs-layout'>,</span> <span class='hs-varid'>mergeCluster</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>23: </span>
<span class=hs-linenum>24: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span> <span class='hs-layout'>(</span><span class='hs-varid'>minimumBy</span><span class='hs-layout'>)</span>
<span class=hs-linenum>25: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>MapReduce</span>
<span class=hs-linenum>26: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Assert</span>
<span class=hs-linenum>27: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>List</span>
<span class=hs-linenum>28: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span><span class='hs-layout'>,</span> <span class='hs-varid'>repeat</span><span class='hs-layout'>,</span> <span class='hs-varid'>foldr</span><span class='hs-layout'>,</span> <span class='hs-varid'>zipWith</span><span class='hs-layout'>)</span>
<span class=hs-linenum>29: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>M</span>
<span class=hs-linenum>30: </span>
<span class=hs-linenum>31: </span><span class='hs-definition'>centroid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Point</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Point</span>
<span class=hs-linenum>32: </span><span class='hs-definition'>distance</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Point</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Point</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span>
<span class=hs-linenum>33: </span><span class='hs-definition'>nearest</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Centering</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Point</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Center</span>
<span class=hs-linenum>34: </span><span class='hs-definition'>mergeCluster</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Cluster</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Cluster</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Cluster</span>
<span class=hs-linenum>35: </span><span class='hs-definition'>kmeans1</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>List</span> <span class='hs-conid'>Point</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Centering</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Centering</span>
<span class=hs-linenum>36: </span><span class='hs-definition'>kmeans</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>List</span> <span class='hs-conid'>Point</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Centering</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Centering</span>
</pre>
</div>
<p>Next, lets use our <code>MapReduce</code> library to implement <a href="http://en.wikipedia.org/wiki/K-means_clustering">K-Means Clustering</a></p>
<h2 id="points-and-clusters">Points and Clusters</h2>
<p>First, lets define the various types that model the key entities in clustering.</p>
<pre><span class=hs-linenum>51: </span><span class='hs-comment'>-- | N-Dimensional Point</span>
<span class=hs-linenum>52: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>Point</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List</span> <span class='hs-conid'>Double</span>
<span class=hs-linenum>53: </span>
<span class=hs-linenum>54: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>PointN</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ListN</span> <span class='hs-conid'>Double</span> <span class='hs-conid'>N</span> <span class='hs-keyword'>@-}</span>
</pre>
<p><strong>A Center</strong> is a number between <code>0</code> and <code>k</code> (written <code>CenterK k</code>).</p>
<pre><span class=hs-linenum>60: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>Center</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>61: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>CenterK</span> <span class='hs-conid'>K</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Int</span> <span class='hs-keyglyph'>|</span> <span class='hs-num'>0</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;</span> <span class='hs-conid'>K</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
</pre>
<p><strong>A Centering</strong> is a map from <code>Center</code>s to <code>Point</code>s. Our clustering algorithm will aim to group a (large) set of <code>Point</code>s into <code>k</code> representatives. Thus, a <em>k-n-Centering</em> is a map from <code>CenterK k</code> to <code>PointN n</code>:</p>
<pre><span class=hs-linenum>69: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>Centering</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Center</span> <span class='hs-conid'>Point</span>
<span class=hs-linenum>70: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>CenteringKN</span> <span class='hs-conid'>K</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>CenterK</span> <span class='hs-conid'>K</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>PointN</span> <span class='hs-conid'>N</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
</pre>
<p><strong>A Cluster</strong> is a pair of a <em>number</em> of points (denoting the cluster size) and the <em>co-ordinates</em> denoting the (sum of) the co-ordinates of all the points in the cluster. We represent <code>n</code>-dimensional clusters as <code>ClusterN n</code>; note that the cluster size is <em>strictly positive</em> as we will never represent empty clusters.</p>
<pre><span class=hs-linenum>79: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>Cluster</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Point</span><span class='hs-layout'>)</span>
<span class=hs-linenum>80: </span>
<span class=hs-linenum>81: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ClusterN</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span><span class='hs-layout'>,</span> <span class='hs-conid'>PointN</span> <span class='hs-conid'>N</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>82: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Pos</span>        <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Int</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
</pre>
<h2 id="a-computing-euclidean-distance">(a) Computing Euclidean Distance</h2>
<p>If you did the <code>zipWith</code> problem, then you should see an error in the implementation of <code>distance</code> which computes the <a href="http://en.wikipedia.org/wiki/Euclidean_distance">Euclidean Distance</a> between two points. Fix the <strong>specification</strong> (not the code) of <code>distance</code> so that the code is verified by LH:</p>
<pre><span class=hs-linenum>95: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>distance</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>96: </span><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; {v : (List Double) | size v == x1} -&gt; {v : (List Double) | size v == x1} -&gt; Double</span><span class='hs-definition'>distance</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | size v == n}</span><span class='hs-varid'>px</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | size v == n}</span><span class='hs-varid'>py</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>Double -&gt; Double</span><span class='hs-varid'>sqrt</span></a> <span class='hs-varop'>$</span> <a class=annot href="#"><span class=annottext>Double -&gt; (List Double) -&gt; Double</span><span class='hs-varid'>foldr</span></a> <a class=annot href="#"><span class=annottext>x1:Double -&gt; x2:Double -&gt; {v : Double | v == x1 + x2}</span><span class='hs-layout'>(</span></a><span class='hs-varop'>+</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>0</span></a> <span class='hs-varop'>$</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == size x1} -&gt; {v : (List Double) | size v == size x1}</span><span class='hs-varid'>zipWith</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Double</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-varid'>y</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>Double -&gt; Double</span><span class='hs-varid'>abs</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Double | v == x}</span><span class='hs-varid'>x</span></a><a class=annot href="#"><span class=annottext>Double -&gt; Integer -&gt; Double</span><span class='hs-varop'>^</span></a><a class=annot href="#"><span class=annottext>Integer</span><span class='hs-num'>2</span></a> <a class=annot href="#"><span class=annottext>x1:Double -&gt; x2:Double -&gt; {v : Double | v == x1 - x2}</span><span class='hs-comment'>-</span></a> <a class=annot href="#"><span class=annottext>{v : Double | v == y}</span><span class='hs-varid'>y</span></a><a class=annot href="#"><span class=annottext>Double -&gt; Integer -&gt; Double</span><span class='hs-varop'>^</span></a><a class=annot href="#"><span class=annottext>Integer</span><span class='hs-num'>2</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == px}</span><span class='hs-varid'>px</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == py}</span><span class='hs-varid'>py</span></a>
</pre>
<h2 id="b-map-points-to-nearest-center">(b) Map Points To Nearest Center</h2>
<p>Use <code>distance</code> to fill in the <strong>implementation</strong> of <code>nearest</code> so that LH verifies the given type signature.</p>
<pre><span class=hs-linenum>106: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>nearest</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CenteringKN</span> <span class='hs-varid'>k</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CenterK</span> <span class='hs-varid'>k</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>107: </span><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; x2:{v : Int | v &gt; 0} -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2}) -&gt; {v : (List Double) | size v == x2} -&gt; {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1}</span><span class='hs-definition'>nearest</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>(Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k} {v : (List Double) | size v == n})</span><span class='hs-varid'>centers</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | size v == n}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0} Double) -&gt; {v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0}</span><span class='hs-varid'>minKeyMap</span></a> <a class=annot href="#"><span class=annottext>(Map {v : Int | v &gt;= 0 &amp;&amp; v &gt;= 0 &amp;&amp; v &lt; k &amp;&amp; v &lt; k} Double)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>(Map {v : Int | v &gt;= 0 &amp;&amp; v &gt;= 0 &amp;&amp; v &lt; k &amp;&amp; v &lt; k} {v : (List Double) | size v == n}) -&gt; (Map {v : Int | v &gt;= 0 &amp;&amp; v &gt;= 0 &amp;&amp; v &lt; k &amp;&amp; v &lt; k} Double)</span><span class='hs-conid'>M</span></a><span class='hs-varop'>.</span><span class='hs-varid'>map</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | size v == n} -&gt; Double</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; {v : (List Double) | size v == x1} -&gt; {v : (List Double) | size v == x1} -&gt; Double</span><span class='hs-varid'>distance</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == n}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p}</span><span class='hs-varid'>p</span></a><span class='hs-layout'>)</span>  <a class=annot href="#"><span class=annottext>{v : (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k} {v : (List Double) | size v == n}) | v == centers}</span><span class='hs-varid'>centers</span></a><span class='hs-layout'>)</span>
</pre>
<p>You may want to use the helper <code>minKeyMap</code> that computes the key with the smallest value in a <code>Map</code>:</p>
<pre><span class=hs-linenum>114: </span><span class='hs-comment'>--- &gt;&gt;&gt; minKeyMap (M.fromList [(0, 12), (1, 23), (2, 7), (3,18)])</span>
<span class=hs-linenum>115: </span><span class='hs-comment'>--- 2</span>
<span class=hs-linenum>116: </span><span class='hs-definition'>minKeyMap</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span>
<span class=hs-linenum>117: </span><a class=annot href="#"><span class=annottext>(Ord b) =&gt; (Map a b) -&gt; a</span><span class='hs-definition'>minKeyMap</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : [(a, b)] | len v &gt;= 0} -&gt; a</span><span class='hs-varid'>minKeyList</span></a> <span class='hs-varop'>.</span> <a class=annot href="#"><span class=annottext>(Map a b) -&gt; [(a, b)]</span><span class='hs-conid'>M</span></a><span class='hs-varop'>.</span><span class='hs-varid'>toList</span>
<span class=hs-linenum>118: </span>
<span class=hs-linenum>119: </span><span class='hs-definition'>minKeyList</span>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-layout'>,</span><span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span>
<span class=hs-linenum>120: </span><a class=annot href="#"><span class=annottext>(Ord b) =&gt; {VV : [(a, b)] | len VV &gt;= 0} -&gt; a</span><span class='hs-definition'>minKeyList</span></a> <a class=annot href="#"><span class=annottext>{VV : [(a, b)] | len VV &gt;= 0}</span><span class='hs-varid'>xs</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(a, b) -&gt; a</span><span class='hs-varid'>fst</span></a> <span class='hs-varop'>$</span> <a class=annot href="#"><span class=annottext>((a, b) -&gt; (a, b) -&gt; Ordering) -&gt; [(a, b)] -&gt; (a, b)</span><span class='hs-varid'>minimumBy</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>(a, b)</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>(a, b)</span><span class='hs-varid'>x2</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:a -&gt; x2:a -&gt; {v : Ordering | (v == GHC.Types.EQ &lt;=&gt; x1 == x2) &amp;&amp; (v == GHC.Types.LT &lt;=&gt; x1 &lt; x2) &amp;&amp; (v == GHC.Types.GT &lt;=&gt; x1 &gt; x2)}</span><span class='hs-varid'>compare</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-layout'>(</span></a><span class='hs-varid'>snd</span> <a class=annot href="#"><span class=annottext>{v : (a, b) | v == x1}</span><span class='hs-varid'>x1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>a</span><span class='hs-layout'>(</span></a><span class='hs-varid'>snd</span> <a class=annot href="#"><span class=annottext>(a, b)</span><span class='hs-varid'>x2</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : [(a, b)] | v == xs}</span><span class='hs-varid'>xs</span></a>
</pre>
<p>When you are done, you should get the following behavior:</p>
<pre><span class=hs-linenum>127: </span><span class='hs-comment'>-- &gt;&gt;&gt; test_nearest</span>
<span class=hs-linenum>128: </span><span class='hs-comment'>-- 1</span>
<span class=hs-linenum>129: </span><a class=annot href="#"><span class=annottext>{VV : Int | VV &gt;= 0 &amp;&amp; VV &gt;= 0}</span><span class='hs-definition'>test_nearest</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; x2:{v : Int | v &gt; 0} -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2}) -&gt; {v : (List Double) | size v == x2} -&gt; {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1}</span><span class='hs-varid'>nearest</span></a> <a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>3</span></a> <a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>2</span></a> <a class=annot href="#"><span class=annottext>(Map {v : Int | 0 &lt;= v &amp;&amp; v &gt;= 0} (List Double))</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>[({v : Int | 0 &lt;= v &amp;&amp; v &gt;= 0}, (List Double))] -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &gt;= 0} (List Double))</span><span class='hs-conid'>M</span></a><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <a class=annot href="#"><span class=annottext>[({v : Int | v &gt;= 0 &amp;&amp; v &gt;= 0 &amp;&amp; v == fst x18}, {v : (List Double) | v == snd x18})]</span><span class='hs-keyglyph'>[</span></a><a class=annot href="#"><span class=annottext>({v : Int | 0 &lt;= v &amp;&amp; v == 0}, {v : (List Double) | v == p0})</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>0</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p0}</span><span class='hs-varid'>p0</span></a><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>({v : Int | v &gt; 0 &amp;&amp; v == 1}, {v : (List Double) | v == p1})</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>1</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p1}</span><span class='hs-varid'>p1</span></a><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | v == p2})</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>2</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p2}</span><span class='hs-varid'>p2</span></a><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p}</span><span class='hs-varid'>p</span></a>
<span class=hs-linenum>130: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>131: </span>    <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-varid'>p0</span><span class='hs-layout'>,</span> <span class='hs-varid'>p1</span><span class='hs-layout'>,</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Point</span>
<span class=hs-linenum>132: </span>    <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-varid'>p0</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>0.0</span></a> <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>0.0</span></a> <a class=annot href="#"><span class=annottext>{v : (List a) | size v == 0}</span><span class='hs-varid'>empty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>133: </span>    <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-varid'>p1</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>3.0</span></a> <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>0.0</span></a> <a class=annot href="#"><span class=annottext>{v : (List a) | size v == 0}</span><span class='hs-varid'>empty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>134: </span>    <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-varid'>p2</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>0.0</span></a> <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>3.0</span></a> <a class=annot href="#"><span class=annottext>{v : (List a) | size v == 0}</span><span class='hs-varid'>empty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>135: </span>    <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-varid'>p</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>2.9</span></a> <a class=annot href="#"><span class=annottext>(List Double)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == 1 + size x1}</span><span class='hs-varid'>add</span></a> <a class=annot href="#"><span class=annottext>Double</span><span class='hs-num'>1.1</span></a> <a class=annot href="#"><span class=annottext>{v : (List a) | size v == 0}</span><span class='hs-varid'>empty</span></a><span class='hs-layout'>)</span>
</pre>
<h2 id="c-reduce-clusters">(c) Reduce Clusters</h2>
<p>Fix the <strong>specification</strong> below so that that LH verifies <code>mergeCluster</code> which takes two <code>Cluster</code> and merges them by adding up their points and centers. (Leave the code unmodified).</p>
<pre><span class=hs-linenum>147: </span>
<span class=hs-linenum>148: </span>
<span class=hs-linenum>149: </span>
<span class=hs-linenum>150: </span>
<span class=hs-linenum>151: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>mergeCluster</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ClusterN</span> <span class='hs-varid'>n</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ClusterN</span> <span class='hs-varid'>n</span>  <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>ClusterN</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>152: </span><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt;= 0} -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == x1}) -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == x1}) -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == x1})</span><span class='hs-definition'>mergeCluster</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0}</span><span class='hs-varid'>n</span></a> <span class='hs-layout'>(</span><span class='hs-varid'>n1</span><span class='hs-layout'>,</span> <span class='hs-varid'>p1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n2</span><span class='hs-layout'>,</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:a -&gt; x2:{VV : b | true} -&gt; {v : (a, b) | clusterDimension v == size x2 &amp;&amp; snd v == x2 &amp;&amp; fst v == x1 &amp;&amp; x_Tuple22 v == x2 &amp;&amp; x_Tuple21 v == x1}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Int | v == n1}</span><span class='hs-varid'>n1</span></a> <a class=annot href="#"><span class=annottext>x1:Int -&gt; x2:Int -&gt; {v : Int | v == x1 + x2}</span><span class='hs-varop'>+</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == n2}</span><span class='hs-varid'>n2</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == size x1} -&gt; {v : (List Double) | size v == size x1}</span><span class='hs-varid'>zipWith</span></a> <a class=annot href="#"><span class=annottext>x1:Double -&gt; x2:Double -&gt; {v : Double | v == x1 + x2}</span><span class='hs-layout'>(</span></a><span class='hs-varop'>+</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p1}</span><span class='hs-varid'>p1</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p2}</span><span class='hs-varid'>p2</span></a><span class='hs-layout'>)</span>
</pre>
<p><strong>Note:</strong> The code above uses <code>zipWith</code>; so you will only see the error and be able to fix it, <em>after</em> you solve that problem.</p>
<h2 id="d-convert-cluster-into-centroid-point">(d) Convert Cluster into Centroid Point</h2>
<p>The <code>centroid</code> function converts a <code>Cluster</code> into a single <code>Point</code> by dividing each co-ordinate with the cluster size. Fix the <strong>specification</strong> of <code>centroid</code> so that LH verifies the call to <code>divide</code>:</p>
<pre><span class=hs-linenum>166: </span>
<span class=hs-linenum>167: </span>
<span class=hs-linenum>168: </span>
<span class=hs-linenum>169: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>centroid</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>170: </span><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt;= 0} -&gt; {v : (List Double) | size v == x1} -&gt; {v : Int | v &gt; 0} -&gt; {v : (List Double) | size v == x1}</span><span class='hs-definition'>centroid</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | size v == n}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>sz</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(List Double) -&gt; {v : (List Double) | size v == size x1}</span><span class='hs-varid'>map</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Double</span><span class='hs-varid'>x</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{v : Double | v == x}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>Double -&gt; {v : Int | v /= 0} -&gt; Double</span><span class='hs-varop'>`divide`</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == sz}</span><span class='hs-varid'>sz</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p}</span><span class='hs-varid'>p</span></a>
</pre>
<p><strong>Note:</strong> The code below uses <code>map</code> from <code>List.lhs</code>; and hence your solution will only work if you solved that problem first.</p>
<h2 id="e-iterative-clustering">(e) Iterative Clustering</h2>
<p>The Kmeans clustering algorithm is shown below:</p>
<pre><span class=hs-linenum>185: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>kmeans</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>186: </span>              <span class='hs-conid'>List</span> <span class='hs-layout'>(</span><span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CenteringKN</span> <span class='hs-varid'>k</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CenteringKN</span> <span class='hs-varid'>k</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>187: </span>  <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>188: </span><a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0} -&gt; x2:{v : Int | v &gt; 0} -&gt; x3:{v : Int | v &gt; 0} -&gt; (List {v : (List Double) | size v == x3}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x2} {v : (List Double) | size v == x3}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x2} {v : (List Double) | size v == x3})</span><span class='hs-definition'>kmeans</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>steps</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>(List {v : (List Double) | size v == n})</span><span class='hs-varid'>ps</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : Int | 0 &lt;= VV &amp;&amp; VV &gt;= 0} -&gt; (a -&gt; a) -&gt; a -&gt; a</span><span class='hs-varid'>repeat</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == steps}</span><span class='hs-varid'>steps</span></a> <a class=annot href="#"><span class=annottext>(Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k} {v : (List Double) | size v == n}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k} {v : (List Double) | size v == n})</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; x2:{v : Int | v &gt; 0} -&gt; (List {v : (List Double) | size v == x2}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2})</span><span class='hs-varid'>kmeans1</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == k}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == n}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : (List {v : (List Double) | size v == n}) | v == ps}</span><span class='hs-varid'>ps</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>189: </span>
<span class=hs-linenum>190: </span><span class='hs-definition'>repeat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>191: </span><a class=annot href="#"><span class=annottext>{VV : Int | 0 &lt;= VV &amp;&amp; VV &gt;= 0} -&gt; (a -&gt; a) -&gt; a -&gt; a</span><span class='hs-definition'>repeat</span></a> <span class='hs-num'>0</span> <a class=annot href="#"><span class=annottext>a -&gt; a</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a>
<span class=hs-linenum>192: </span><span class='hs-definition'>repeat</span> <span class='hs-varid'>n</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : Int | 0 &lt;= VV &amp;&amp; VV &gt;= 0} -&gt; (a -&gt; a) -&gt; a -&gt; a</span><span class='hs-varid'>repeat</span></a> <a class=annot href="#"><span class=annottext>Int</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>Int</span><span class='hs-varid'>n</span></a><a class=annot href="#"><span class=annottext>x1:Int -&gt; x2:Int -&gt; {v : Int | v == x1 - x2}</span><span class='hs-comment'>-</span></a><a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>a -&gt; a</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>a -&gt; a</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a><span class='hs-layout'>)</span>
</pre>
<p>In essence we start with an initial <code>k</code> centering, and repeatedly update it by calling <code>kmeans1</code> which takes as input a list of <code>n</code> dimensional points, a centering and returns a new centering (with <code>k</code> centers and <code>n</code> dimensional points). The new centers are computed by:</p>
<ol style="list-style-type: decimal">
<li>Mapping each point to its <code>nearest</code> center,</li>
<li>Grouping all the points mapped to a center into a new cluster,</li>
<li>Reducing the clusters by adding up all the points inside them, and</li>
<li>Normalizing each cluster to its <code>centroid</code>.</li>
</ol>
<pre><span class=hs-linenum>205: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>kmeans1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Pos</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>206: </span>               <span class='hs-conid'>List</span> <span class='hs-layout'>(</span><span class='hs-conid'>PointN</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CenteringKN</span> <span class='hs-varid'>k</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CenteringKN</span> <span class='hs-varid'>k</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>207: </span>  <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>208: </span><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; x2:{v : Int | v &gt; 0} -&gt; (List {v : (List Double) | size v == x2}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2})</span><span class='hs-definition'>kmeans1</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt; 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>(List {v : (List Double) | size v == n})</span><span class='hs-varid'>ps</span></a> <a class=annot href="#"><span class=annottext>(Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k} {v : (List Double) | size v == n})</span><span class='hs-varid'>cs</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map a ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n})) -&gt; (Map a {v : (List Double) | size v == n})</span><span class='hs-varid'>normalize</span></a> <a class=annot href="#"><span class=annottext>{v : (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0} ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n})) | v == newClusters}</span><span class='hs-varid'>newClusters</span></a>
<span class=hs-linenum>209: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>210: </span>    <span class='hs-varid'>normalize</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-conid'>Cluster</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-conid'>Point</span>
<span class=hs-linenum>211: </span>    <a class=annot href="#"><span class=annottext>(Map a ({VV : Int | VV &gt; 0 &amp;&amp; VV &gt; 0}, {VV : (List Double) | size VV == n})) -&gt; (Map a {VV : (List Double) | size VV == n})</span><span class='hs-varid'>normalize</span></a>     <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) -&gt; {v : (List Double) | size v == n}</span><span class='hs-conid'>M</span></a><span class='hs-varop'>.</span><span class='hs-varid'>map</span> <a class=annot href="#"><span class=annottext>{VV : (List Double) | size VV == n}</span><span class='hs-layout'>(</span></a><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>sz</span><span class='hs-layout'>,</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt;= 0} -&gt; {v : (List Double) | size v == x1} -&gt; {v : Int | v &gt; 0} -&gt; {v : (List Double) | size v == x1}</span><span class='hs-varid'>centroid</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == n}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == sz}</span><span class='hs-varid'>sz</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>212: </span>    <a class=annot href="#"><span class=annottext>(Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0} ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}))</span><span class='hs-varid'>newClusters</span></a>   <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>({v : (List Double) | size v == n} -&gt; (List ({v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0}, ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n})))) -&gt; (({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) -&gt; ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) -&gt; ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n})) -&gt; (List {v : (List Double) | size v == n}) -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0} ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}))</span><span class='hs-varid'>mapReduce</span></a> <a class=annot href="#"><span class=annottext>x1:{v : (List Double) | size v == n} -&gt; (List ({v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0 &amp;&amp; v == fst x20}, {v : ({v : Int | v &lt;= k &amp;&amp; v &lt;= n &amp;&amp; v &gt; 0 &amp;&amp; v == fst x36 &amp;&amp; v == 1}, {v : (List Double) | size v == n &amp;&amp; v == x1 &amp;&amp; v == snd x36}) | v == snd x20}))</span><span class='hs-varid'>fm</span></a> <a class=annot href="#"><span class=annottext>({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) -&gt; ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == n})</span><span class='hs-varid'>fr</span></a> <a class=annot href="#"><span class=annottext>{v : (List {v : (List Double) | size v == n}) | v == ps}</span><span class='hs-varid'>ps</span></a>
<span class=hs-linenum>213: </span>    <a class=annot href="#"><span class=annottext>p:{VV : (List Double) | size VV == n} -&gt; (List ({VV : Int | 0 &lt;= VV &amp;&amp; VV &lt; k &amp;&amp; VV &lt; k &amp;&amp; VV &gt;= 0 &amp;&amp; VV == fst VV}, {VV : ({VV : Int | VV &lt;= k &amp;&amp; VV &lt;= n &amp;&amp; VV &gt; 0 &amp;&amp; VV == fst VV &amp;&amp; VV == 1}, {VV : (List Double) | size VV == n &amp;&amp; VV == p &amp;&amp; VV == snd VV}) | VV == snd VV}))</span><span class='hs-varid'>fm</span></a> <a class=annot href="#"><span class=annottext>{VV : (List Double) | size VV == n}</span><span class='hs-varid'>p</span></a>          <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>a -&gt; {v : (List a) | size v == 1}</span><span class='hs-varid'>singleton</span></a> <a class=annot href="#"><span class=annottext>({v : Int | 0 &lt;= v &amp;&amp; v &lt; k &amp;&amp; v &lt; k &amp;&amp; v &gt;= 0}, ({v : Int | v == fst x27 &amp;&amp; v &lt;= k &amp;&amp; v &lt;= n &amp;&amp; v &gt; 0 &amp;&amp; v == 1}, {v : (List Double) | v == snd x27 &amp;&amp; size v == n &amp;&amp; v == p}))</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt; 0} -&gt; x2:{v : Int | v &gt; 0} -&gt; (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1} {v : (List Double) | size v == x2}) -&gt; {v : (List Double) | size v == x2} -&gt; {v : Int | 0 &lt;= v &amp;&amp; v &lt; x1}</span><span class='hs-varid'>nearest</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == k}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == n}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : (Map {v : Int | 0 &lt;= v &amp;&amp; v &lt; k} {v : (List Double) | size v == n}) | v == cs}</span><span class='hs-varid'>cs</span></a> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p}</span><span class='hs-varid'>p</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>({v : Int | v &lt;= k &amp;&amp; v &lt;= n &amp;&amp; v &gt; 0 &amp;&amp; v == 1}, {v : (List Double) | size v == n &amp;&amp; v == p})</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>Int</span><span class='hs-num'>1</span></a> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{v : (List Double) | v == p}</span><span class='hs-varid'>p</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>214: </span>    <a class=annot href="#"><span class=annottext>({VV : Int | VV &gt; 0 &amp;&amp; VV &gt; 0}, {VV : (List Double) | size VV == n}) -&gt; ({VV : Int | VV &gt; 0 &amp;&amp; VV &gt; 0}, {VV : (List Double) | size VV == n}) -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == n})</span><span class='hs-varid'>fr</span></a> <a class=annot href="#"><span class=annottext>({VV : Int | VV &gt; 0 &amp;&amp; VV &gt; 0}, {VV : (List Double) | size VV == n})</span><span class='hs-varid'>wp1</span></a> <a class=annot href="#"><span class=annottext>({VV : Int | VV &gt; 0 &amp;&amp; VV &gt; 0}, {VV : (List Double) | size VV == n})</span><span class='hs-varid'>wp2</span></a>    <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:{v : Int | v &gt;= 0} -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == x1}) -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == x1}) -&gt; ({v : Int | v &gt; 0}, {v : (List Double) | size v == x1})</span><span class='hs-varid'>mergeCluster</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v == n}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) | v == wp1}</span><span class='hs-varid'>wp1</span></a> <a class=annot href="#"><span class=annottext>{v : ({v : Int | v &gt; 0 &amp;&amp; v &gt; 0}, {v : (List Double) | size v == n}) | v == wp2}</span><span class='hs-varid'>wp2</span></a>
</pre>
<p>Fix the code and specifications above so that LH verifies the the specification for <code>kmeans</code> and <code>kmeans1</code> (i.e. verifies this entire module.)</p>
<p><strong>Hint:</strong> If you did the above problems correctly, you should have to do nothing here. Otherwise, think about what type <code>normalize</code> should have and try to work backwards to verify that type.</p>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>
